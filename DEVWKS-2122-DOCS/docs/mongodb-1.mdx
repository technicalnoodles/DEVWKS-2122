---
sidebar_position: 4
---

# MongoDb Part 1

Mongo is the database this application uses to store data. It has events that we can create or remove, and it will hold the user information we get back from WebEx.

This workshop uses a library called `Mongoose` to handle connecting and doing database operations for us. We will not need to install this library as it is already installed and being used to store events.

In the `index.js`, we can see the few lines that mention Mongoose.

```javascript title=index.js showLineNumbers
const express = require('express');
//highlight-next-line
const mongoose = require('mongoose');
require('./services/passport');
require('./models/Event');
references;

const port = 5000;

main().catch((err) => console.log(err));
//highlight-next-line
async function main() {
  //highlight-next-line
  await mongoose.connect('mongodb://localhost:27017');
  //highlight-next-line
  // use `await mongoose.connect('mongodb://user:password@localhost:27017/test');` if your database has auth enabled
  //highlight-next-line
}

const app = express();
app.use(express.json());
require('./routes/authRoutes')(app);

require('./routes/eventRoutes')(app);

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```

At the top of the file, we import Mongoose using a require statement. A little further down, we have an async function that waits for mongoose to connect the Mongo database. This line is prefilled with the Mongo URI that we will use to connect to the database.

The rest of the Mongoose components we need to control data is in this line:

```javascript
require('./routes/eventRoutes')(app);
```

In the `routes.eventRoutes.js` file, there is one line at the top that we want to look at.

```javascript
const Event = mongoose.model('event');
```

This line above references a `model`. Mongoose uses `models` to interact with the database. Each `model` is the format of one entry in the database. We can use this model to query a specific collection of data by doing an update, reading, and writing to that collection of data. The `model` will contain all the information needed to make those queries. It is good to note, that each `model` corresponds to one collection in the Mongo database.

In the `/models/Event.js` file, we can see how a `model` is formatted:

```javascript title=models/Event.js showLineNumbers
const mongoose = require('mongoose');
const { Schema } = mongoose;

const eventSchema = new Schema({
  title: String, // String is shorthand for {type: String}
  active: Boolean,
});

const event = mongoose.model('event', eventSchema);
```

In the code of the `Event.js` file, we can see it imports `Schema` from Mongoose. A `Schema` is the blueprint for the `model`. The `Schema` for this model only has two properties: a string called `title` and a Boolean called `active`. These are the default fields that are always required when you want to create a new event.  
:::note
This does not mean we cannot add more data to an event though. We can add as many properties as we want, but those two must be included.  
:::

After the `Schema` has been created, we can create a `model` out of it. The `mongoose.model` function takes two arguments. The first argument is the name of the collection (in this case, `event`) and the second is the `schema` that was created (`eventSchema`). When the `mongoose.model` is called, it will create a new collection called `event` and the `Schema` is the interface to accessing the collection.  
:::info
If there is already a collection in the database called `event`, Mongoose will not recreate the `event` collection.
:::

We have looked at some examples of what we will be doing, but now we need to create a `user` model.

## Creating a User model

In the `models` directory, we need to create a new file called `User.js`

After it is created, open the `User.js` file in the code editor. We need to do our initial imports like in the `Event` model.

```javascript title=models/User.js showLineNumbers
const mongoose = require('mongoose');
const { Schema } = mongoose;
const userSchema = new Schema({
  ciscoId: String,
  name: String,
  departmentId: String,
});

mongoose.model('users', userSchema);
```

After importing Mongoose and pulling out the `Schema` function, we can create our `userSchema`. The `userSchema` will contain three properties: `ciscoId`, `name`, and `departmentId`. These will all be values we store after the authentication flow has finished.

We now need to call `model` function to create a new collection called `users` and to create an interface with the `userSchema`.

We have finished the MongoDb portion of the workshop. We will return to working with Passport now.
