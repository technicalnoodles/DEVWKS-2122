---
sidebar_position: 6
---

# Creating Cookies

## Creating a Session Cookie

To create a cookie for our users. We need to tell Passport to use a cookie and to do this we need to install a library called `cookie-session`.

### Install cookie-session

In the CLI run the below command to install `cookie-session`.

`npm install cookie-session`

### Create a Cookie Encryption Key

We need to update the `keys.js` file after it has finished installing. Open the `keys.js` file in the `config` directory. We need to add a new property to the object in this file called `cookieKey`. This object will be used as the encryption key for the cookie. This is an example of what the file should look after adding the `cookieKey` property.

```javascript title=config/keys.js showLineNumbers
module.exports({
  ciscoClientID: 'asdfasdfasd',
  ciscoClientSecret: 'sdfgasdfa',
  //add-line
  cookieKey: 'randomstring',
});
```

### Update Passport to Use a Cookie

Now we need to update the `index.js` file. This will include importing the `cookieKey`, importing the required libraries, telling the application to create a cookie, and configuring Passport to use the cookie.

We first need to import `cookie-session`, `passport`, and the `keys` file.

```javascript title=index.js showLineNumbers
const express = require('express');
const mongoose = require('mongoose');
//add-line
const cookieSession = require('cookie-session');
//add-line
const passport = require('passport');
//add-line
const keys = require('./config/keys');
require('./models/User');
require('./services/passport');
require('./models/Event');

const port = 5000;
```

Now we can configure the application to use create a cookie. We will tell the `app` to use the `cookieSession` we imported. `cookieSession` takes an object as an argument. The object has two properties in it: `maxAge` and `keys`. The `maxAge` property is the amount of time a cookie has before it expires in milliseconds. The `keys` property is a list of keys that can be used to encrypt the session cookie.

```javascript title=index.js showLineNumbers
const express = require('express');
const mongoose = require('mongoose');
const cookieSession = require('cookie-session');
const passport = require('passport');
const keys = require('./config/keys');
require('./models/User');
require('./services/passport');
require('./models/Event');

const port = 5000;

main().catch((err) => console.log(err));

async function main() {
  await mongoose.connect('mongodb://localhost:27017');
  // use `await mongoose.connect('mongodb://user:password@localhost:27017/test');` if your database has auth enabled
}

const app = express();
app.use(express.json());
//add-line
app.use(
  //add-line
  cookieSession({
    //add-line
    maxAge: 2 * 24 * 60 * 60 * 1000,
    //add-line
    keys: [keys.cookieKey],
    //add-line
  })
  //add-line
);
```

Lastly we need to tell Passport to use the cookie in a session. This is done with only two additional lines. The `initialize` function tells passport to use the `serialize` and `deserialize` functions we defined earlier. The `session` function tells passport to use sessions after an authentication flow completes.

```javascript title=index.js showLineNumbers
const express = require('express');
const mongoose = require('mongoose');
const cookieSession = require('cookie-session');
const passport = require('passport');
const keys = require('./config/keys');
require('./models/User');
require('./services/passport');
require('./models/Event');

const port = 5000;

main().catch((err) => console.log(err));

async function main() {
  await mongoose.connect('mongodb://localhost:27017');
  // use `await mongoose.connect('mongodb://user:password@localhost:27017/test');` if your database has auth enabled
}

const app = express();
app.use(express.json());

app.use(
  cookieSession({
    maxAge: 2 * 24 * 60 * 60 * 1000,
    keys: [keys.cookieKey],
  })
);
//add-line
app.use(passport.initialize());
//add-line
app.use(passport.session());
```

### Testing

We can try running the `index.js` file now. To do this run the below command:

`node index.js`

Then attempt to authenticate using the below URL:

`localhost:5000/auth/cisco`

It should ask for a login and permissions.
