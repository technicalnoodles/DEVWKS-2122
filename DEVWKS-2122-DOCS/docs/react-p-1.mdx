---
sidebar_position: 7
---

# Front-end Part 1

We need to make our React frontend be able to detect when a user is logged in and then allow them to access the Events in our application.

In this section we will be working with React, React Router, and Redux.

React is a frontend library used to create web UIs. React Router is a library that React can use to change pages in the application. Redux is a state library used to manage state and to pass state from one component to another without creating many dependencies.

We will start working with Redux first. There is some boiler plate code that has been inserted into the `index.js` file to save on time.

Please open the `client` directory to see the React code.

## Redux Setup

### Creating Actions

Actions in Redux are what tell the library what to do. If there is an action of `FETCH_USER`, it will do what has been defined for that action. We will be creating an action called `FETCH_USER`. To do this, we need to create one directory and two files in that directory.

In the `client -> src` directory, make a new directory called `actions`. After it has been created, please create the below files in it:  
`types.js`  
`index.js`

In the `types.js` file, we need create a fetch user type. That will look like the below:

```javascript title=actions/types.js showLineNumbers
export const FETCH_USER = 'fetch_user';
```

This only defines a _type_ of action we can take in Redux.

We will now create the action this type will take in the `index.js`.

```javascript title=actions/index.js showLineNumbers
import axios from 'axios';
import { FETCH_USER } from './types';

export const fetchUser = () => async (dispatch) => {
  const user = await axios.get('/api/current_user');
  dispatch({ type: FETCH_USER, payload: user['data'] });
};
```

In the above file, we first need to import `axios`. This is a network request library. We will use this to access the current user information.

The second line is the `type` of action we want. In this case it is `FETCH_USER`.

The exported function then makes a call to the backend to see if there is a user logged in or not. Then the function `dispatches` the data with a type of `FETCH_USER` and payload of the data from the `axios` call.

Dispatching in Redux means we are calling out to something called a _Reducer_ and updating the state of the application. The _Reducer_ needs to know the _type_ of call it is receiving so it can use the proper update technique and the payload it will use to set the state with. This state is not visible to the user unless we make it visible.

We will now create a Reducer.

### Creating a Reducer

We need to create a directory and two files like we did for the actions. In the `client -> scr` directory, create a new directory called `reducers`. In this directory, please create the below two files:  
`authReducer.js`  
`index.js`

In the `authReducer` file, we need to import the _type_ of _action_ we want to be able to use.

```javascript title=reducers/authReducer.js showLineNumbers
import { FETCH_USER } from '../actions/types';
```

Next we will define the function that will handle these actions.

```javascript title=reducers/authReducer.js showLineNumbers
import { FETCH_USER } from '../actions/types';
//add-line
export default function (state = null, action) {
```

For this function, we are passing two arguments to it. the first is the initial state of our application. In this case we are using `null`. The second is the `action`. This will be passed to the reducer when we use a `dispatch` function in the application. The body of the function will have a switch statement with the different types of state we can return based on the action type.

```javascript title=reducers/authReducer.js showLineNumbers
import { FETCH_USER } from '../actions/types';
export default function (state = null, action) {
  //add-line
  switch (action.type) {
    //add-line
    case FETCH_USER:
      //add-line
      return action.payload || false;
    //add-line
    default:
      //add-line
      return state;
    //add-line
  }
  //add-line
}
```

The first case is if we detect `FETCH_USER`, if the payload of the action is not empty we return the payload to the state of our application. Otherwise, we return `false`.

The `default` case will return the default state we set or whatever the current state is if an un-defined action is sent.

The next thing we need to do is to combine our reducers so Redux is able to easily identify and use them.

In the `index.js` file, we will first import a function called `combineReducers`. This allows to server multiple reducers to redux from a single entry point. Then we will import our `authReducer`.

```javascript title=reducers/index.js showLineNumbers
import { combineReducers } from 'redux';
import authReducer from './authReducer';
```

After the two imports, we need to export the `combineReducers` function with the `authReducer` set to `auth`. The reason for doing this is to give a simpler name to this state. We will now be able to access the `authReducer` state using the `auth` name instead. If we were to use a tool called `Redux DevTools`, we would be able to see a sate called `auth` in our application store.

```javascript title=reducers/index.js showLineNumbers
import { combineReducers } from 'redux';
import authReducer from './authReducer';
//add-line
export default combineReducers({
  //add-line
  auth: authReducer,
  //add-line
});
```

This is all we need to setup for the actions and reducers of Redux. We now need to configure the `store` and add functionality to allow asynchronous calls.

### Configuring the Store

We need to import another library called `reduxThunk`. This library acts as a _middleware_ and allows asynchronous Redux actions to take place. The second thing we need to import is all our _reducers_. The `import reducers from './reducers'` works without specifying a file because Redux looks for a file called `index.js` in the `reducers` directory that should contain all the reducers.

```javascript title=scr/index.js showLineNumbers
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import { Provider } from 'react-redux';
import { createStore, applyMiddleware } from 'redux';
//add-line
import reduxThunk from 'redux-thunk';
//add-line
import reducers from './reducers';
import './styles/cui-standard.min.css';

const store = createStore(reducers, {}, applyMiddleware(reduxThunk));

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

Next we need to edit our `store`. Initially there was a function that returned an empty object. This became the initial state for the entire `store`. Now we are passing `reducers` to it, which is going to set the store default state to what is defined in the reducers.

Lastly we added `reduxThunk` as a middleware. In the `actions/index.js` we use an async function. Now it will work properly and be able to set the state.

```javascript title=scr/index.js showLineNumbers
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import { Provider } from 'react-redux';
import { createStore, applyMiddleware } from 'redux';
import reduxThunk from 'redux-thunk';
import reducers from './reducers';
import './styles/cui-standard.min.css';

//remove-line
const store = createStore(() => {}, {}, applyMiddleware());
//add-line
const store = createStore(reducers, {}, applyMiddleware(reduxThunk));

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

Now the application is configured to use Redux.

We now need to get some running through the React application. We will import some functions we need and initiate the check for if the user is logged in.

```javascript title=src/App.js showLineNumbers
//add-line
import { useEffect } from 'react';
//add-line
import { useDispatch } from 'react-redux';
//add-line
import { fetchUser } from './actions/index';
import { BrowserRouter, Route, Routes } from 'react-router-dom';
import Header from './components/Header';
import ActiveEvents from './pages/ActiveEvents';

function App() {
  //add-line
  const dispatch = useDispatch();
  //add-line
  useEffect(() => {
    //add-line
    dispatch(fetchUser());
    //add-line
  }, []);
  function App() {
    return (
      <div className="">
        <Header />
        <div className="" style={{ marginTop: '7rem' }}>
          <ActiveEvents />
        </div>
      </div>
    );
  }

  export default App;
}
```

We first need to import `useEffect` from react, `useDispatch` from react redux, and our action `fetchUser` from the actions.

After that we need to initialize the `useDispatch`. This will allow us to call the `fetchUser` action in just a moment.

`useEffect` allows us to make an asynchronous call in our code and then update some state. We use `useEffect` because it will render any components that need to be updated after it has finished. In this `useEffect`, we are calling the `dispatch` function with the `fetchUser` action. This will activate the Redux action and reducer, causing a call to our backend to fetch the user. Since the `App.js` is one of the first files loaded in a React project, it makes sense to fetch the user here.

We will come back to the `App.js` file in a little bit so we can refactor the returned code to use the Router. But first we will edit eh `Header.js` component to change the login and logout button after checking the user.

### Login/Logout of Header

We need to add some logic and refactor the header code to change the functionality of the Login and Logout button. First let's import the functions we need from Redux.

We are importing `useSelector` from Redux. This function allows us to access the state of the Redux store from anywhere without needing to do something called prop-drilling. Prop-drilling introduces a multitude of dependency issues in an application and can cause significant issues as a project gets larger.

The second thing we are importing is a `Link` from the React Router. This will tell React which page to show when it is selected.

```javascript title=components/Header.js showLineNumbers
//add-line
import { useSelector } from 'react-redux';
//add-line
import { Link } from 'react-router-dom';
const Header = () => {
  return (
    <header className="header">
      <div className="container">
        <div className="header-panels">
          <div className="header-panel">
            <a className="header__logo" href="http://www.cisco.com">
              <span className="icon-cisco"></span>
            </a>
            <div className="header__title">DEVWKS-2122</div>
          </div>
          <div className="header-panel header-panel--center">
            <div className="header-item">
              <ul id="tabsheader" className="tabs">
                <li id="tabsheader-1" className="tab active">
                  <a tabindex="0">
                    <div className="tab__heading">Active Events</div>
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div className="header-panel header-panel--right">
            <a className="header-item" href="/login">
              <span className="half-margin-right">Log In</span>
              <span className="icon-sign-in icon-size-20"></span>
            </a>
          </div>
        </div>
      </div>
    </header>
  );
};

export default Header;
```

Next is to access the _auth_ state with the `useSelector`. The _state_ that is used in the selector is the Redux store and we are accessing just the _auth_ state in the store. Then we store it as the `loggedIn` variable.

```javascript title=components/Header.js showLineNumbers
import { useSelector } from 'react-redux';
import { Link } from 'react-router-dom';
const Header = () => {
  //add-line
  const loggedIn = useSelector((state) => state.auth);

  return (
    <header className="header">
    <!-- left out or ease of reading -->
    </header>
  );
};

export default Header;
```

We will create a _switch_ statement next. This statement will be used to render a different piece of HTML depending on the value of the `loggedIn` variable.

We have created three cases, one for `null`, `false`, and `default` (for `true`). The `null` and `false` both link to `/auth/cisco` and have the top right say **Login**. The `default` case returns a link with `Logout` linking to `/api/logout` meaning the user is logged in.

```javascript title=components/Header.js showLineNumbers
import { useSelector } from 'react-redux';
import { Link } from 'react-router-dom';
const Header = () => {
  const loggedIn = useSelector((state) => state.auth);
  //add-line
  const renderLogin = () => {
    //add-line
  switch (loggedIn) {
    //add-line
    case null:
        //add-line
        return (
            //add-line
            <a className="header-item" href="/auth/cisco">
            //add-line
            <span className="half-margin-right">Login</span>
            //add-line
            <span className="icon-sign-in icon-size-20"></span>
            //add-line
            </a>
            //add-line
        );
        //add-line
    case false:
        //add-line
        return (
            //add-line
            <a className="header-item" href="/auth/cisco">
            //add-line
            <span className="half-margin-right">Login</span>
            //add-line
            <span className="icon-sign-in icon-size-20"></span>
            //add-line
            </a>
            //add-line
        );
        //add-line
    default:
        //add-line
        return (
            //add-line
            <a className="header-item" href="/api/logout">
            //add-line
            <span className="half-margin-right">Logout</span>
            //add-line
            <span className="icon-sign-in icon-size-20"></span>
            //add-line
            </a>
            //add-line
        );
        //add-line
    }
    //add-line
  };

  return (
    <header className="header">
        <!-- left out or ease of reading -->
    </header>
  );
};

export default Header;
```

Now that our logic is setup, we need to edit the header to use the new logic. In the `Header` function of our component, we will remove the `login` a tag and replace it with the `renderLogin` function. We need to wrap it in curly braces, so it does not get treated as HTML.

```javascript title=components/Header.js
const Header = () => {
  return (
    <header className="header">
      <div className="container">
        <div className="header-panels">
          <div className="header-panel">
            <a className="header__logo" href="http://www.cisco.com">
              <span className="icon-cisco"></span>
            </a>
            <div className="header__title">DEVWKS-2122</div>
          </div>
          <div className="header-panel header-panel--center">
            <div className="header-item">
              <ul id="tabsheader" className="tabs">
                <li id="tabsheader-1" className="tab active">
                  <a tabindex="0">
                    <div className="tab__heading">Active Events</div>
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div className="header-panel header-panel--right">
            //remove-line
            <a className="header-item" href="/login">
              //remove-line
              <span className="half-margin-right">Log In</span>
              //remove-line
              <span className="icon-sign-in icon-size-20"></span>
              //remove-line
            </a>
            //add-line
            {renderLogin()}
          </div>
        </div>
      </div>
    </header>
  );
};
```

After this we need to add some logic to the _Active Events_ tab. We do not want it to render if the user is not logged in. We will also make this **a** tag into a `Link` so React can navigate with it.

```javascript title=components/Header.js
const Header = () => {
  return (
    <header className="header">
      <div className="container">
        <div className="header-panels">
          <div className="header-panel">
            <a className="header__logo" href="http://www.cisco.com">
              <span className="icon-cisco"></span>
            </a>
            <div className="header__title">DEVWKS-2122</div>
          </div>
          <div className="header-panel header-panel--center">
            <div className="header-item">
              <ul id="tabsheader" className="tabs">
                //add-line
                {loggedIn && (
                  <li id="tabsheader-1" className="tab active">
                    //remove-line
                    <a tabindex="0">
                    //add-line
                    <Link to={'/events'}>
                      <div className="tab__heading">Active Events</div>
                      //remove-line
                    </a>
                    //add-line
                    </Link>
                  </li>
                  //add-line
                )}
              </ul>
            </div>
          </div>
          <div className="header-panel header-panel--right">
            <a className="header-item" href="/login">
              <span className="half-margin-right">Log In</span>
              <span className="icon-sign-in icon-size-20"></span>
            </a>
            {renderLogin()}
          </div>
        </div>
      </div>
    </header>
  );
};
```

That is all we need to do in the Header. If we login and logout of the application, we should see the text change between 'login' and 'logout' and the 'Active Events' tab will toggle as well.

Back in the `App.js`, we need to refactor the code to use the React Router and specify the routes for specific components. First we need to import the `Login` page from `pages/Login.js`

```javascript title=src/App.js
import { BrowserRouter, Route, Routes } from 'react-router-dom';
import { useEffect } from 'react';
import { useDispatch } from 'react-redux';
import { fetchUser } from './actions/index';
import Header from './components/Header';
import ActiveEvents from './pages/ActiveEvents';
//add-line
import Login from './pages/Login';

function App() {
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(fetchUser());
  }, []);

  return (
    <div className="">
      //add-line
      <BrowserRouter>
        //add-line
        <Header />
        //add-line
        <div className="" style={{ marginTop: '7rem' }}>
          //add-line
          <Routes>
            //add-line
            <Route path="/" element={<Login />} />
            //add-line
            <Route path="/events" element={<ActiveEvents />} />
            //add-line
          </Routes>
          //add-line
        </div>
        //add-line
      </BrowserRouter>
      //add-line
    </div>
  );
}

export default App;
```

We can replace the entire _return_ in the `App.js` file with the above code. This wraps the application with `BrowserRouter` allowing `Routes` and `Links` to be used in any components wrapped in it. The browser router also integrates into the history of the browser. Now when changing from one route to another it will show up in the browser history.

Now for the main component of the application. For any components we want to be able to access using a route, we need to put it in the `Routes` wrapper. Then create a new `Route` component with the path of the component and what component or element it will render.

There are a few things left to do but those will be back in the backend server code. We need to update our `authRoutes` and add some middleware.
